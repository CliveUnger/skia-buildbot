<!--
  The <runs-page-sk> custom element declaration.

  Shows the results of a runs request, or a list of CT Pixel Diff runs.
  Sends the query string as a JSON request to the runs endpoint ('/json/runs')
  and renders the result.

  Attributes:
    data - A list of CT Pixel Diff runID strings.

  Events:
    None

  Methods:
    None
-->

<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="activity-sk.html">
<link rel="import" href="run-details-sk.html">
<link rel="import" href="shared-styles.html">

<dom-module id="runs-page-sk">
  <template>
    <style include="iron-flex iron-flex-alignment"></style>
    <style include="shared-styles"></style>
    <activity-sk id="activityBar" busy="{{_hideAll}}"></activity-sk>
    <div hidden$="{{_hideAll}}">
      <div hidden$="[[_emptyResult(data)]]">
        <template is="dom-repeat" items="[[data]]" initial-count="20">
          <run-details-sk
            run="[[item]]">
          </run-details-sk>
          <br>
        </template>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      is: "runs-page-sk",

      properties: {
        data: {
          type: Array,
          value: function() { return []; },
        }
      },

      ready: function() {
        this._load();
      },

      _load: function() {
        this.$.activityBar.startSpinner();
        sk.get("/json/runs").then(JSON.parse).then(function (json) {
          this.set('data', json.runs);
          this.$.activityBar.stopSpinner();
        }.bind(this)).catch(function(e) {
          this.$.activityBar.stopSpinner();
          sk.errorMessage(e);
        }.bind(this));
      },

      _emptyResult: function(data) {
        return !data || data.length === 0;
      }
    });
  </script>
</dom-module>
